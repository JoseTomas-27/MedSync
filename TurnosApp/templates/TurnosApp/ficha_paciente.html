<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Ficha Médica | MedSync</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f6fa; margin: 0; }
        .sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 240px; background: #fff; border-right: 1px solid #eee;
            padding: 20px 15px; display: flex; flex-direction: column;
        }
        .sidebar h5 { color: #1976d2; font-weight: 700; text-align: center; margin-bottom: 30px; }
        .sidebar .nav-link { color: #555; font-weight: 500; border-radius: 8px; margin-bottom: 5px; padding: 10px 15px; }
        .sidebar .nav-link.active { background: #e9f3ff; color: #1976d2; font-weight: bold; }
        .sidebar .nav-link:hover { background: #f0f0f0; }
        .page-content { margin-left: 240px; padding: 40px 30px; min-height: 100vh; }
        .ficha-card {
            background: #fff; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 30px;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h5>MedSync</h5>
    <nav class="nav flex-column">
        <a class="nav-link" href="{% url 'dashboard' %}"><i class="fas fa-home me-2"></i>Inicio</a>
        <a class="nav-link" href="{% url 'pacientes' %}"><i class="fas fa-user-injured me-2"></i>Pacientes</a>
    </nav>
    <div class="mt-auto">
        <a href="{% url 'logout' %}" class="nav-link text-danger">
            <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión
        </a>
    </div>
</div>

<div class="page-content">
    {% if paciente %}
    <div class="ficha-card">
        <h3 class="text-primary mb-4"><i class="fas fa-notes-medical me-2"></i>Ficha Médica de {{ paciente.nombre }}</h3>
        <p><strong>RUT:</strong> {{ paciente.rut }}</p>
        <p><strong>Sala:</strong> {{ paciente.sala }}</p>
        <p><strong>País:</strong> {{ paciente.pais }}</p>
        <p><strong>Diagnóstico:</strong> {{ paciente.diagnostico }}</p>
        <p><strong>Medicamentos:</strong> {{ paciente.medicamentos|join:", " }}</p>
        <p><strong>Observaciones:</strong> {{ paciente.observaciones }}</p>
        {% if alerta_epidemiologica %}
<div class="alert alert-danger mt-3">
    {{ alerta_epidemiologica }}
</div>
{% endif %}

{% if covid_data %}
<hr>
<h4 class="text-primary mt-3"><i class="fas fa-virus me-2"></i> Información Automática (COVID-19)</h4>
<p><strong>País analizado:</strong> {{ covid_data.pais }}</p>
<p><strong>Casos confirmados:</strong> {{ covid_data.casos }}</p>
<p><strong>Muertes:</strong> {{ covid_data.muertes }}</p>
<p><strong>Recuperados:</strong> {{ covid_data.recuperados }}</p>
<p class="text-muted"><em>* Datos obtenidos automáticamente desde COVID-19 disease.sh</em></p>
{% endif %}

{% if datos_api %}
    <hr class="my-4">
    <h4 class="text-primary"><i class="fas fa-virus me-2"></i> Información Automática (COVID-19)</h4>

    <p><strong>País analizado:</strong> {{ datos_api.pais }}</p>
    <p><strong>Casos confirmados:</strong> {{ datos_api.casos }}</p>
    <p><strong>Muertes:</strong> {{ datos_api.muertes }}</p>
    <p><strong>Recuperados:</strong> {{ datos_api.recuperados }}</p>

    <p class="text-muted small mt-2">
        * Datos obtenidos automáticamente desde la API externa <b>disease.sh</b>
    </p>
{% endif %}


        <hr class="my-4">

        <a href="{% url 'pacientes' %}" class="btn btn-outline-secondary mt-3">
            <i class="fas fa-arrow-left me-2"></i>Volver a Pacientes
        </a>
    </div>
    {% else %}
    <p class="text-muted">No se encontró la ficha del paciente.</p>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
